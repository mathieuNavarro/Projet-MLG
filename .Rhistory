score=data2$score
inflx=data2$inflx
data2=subset(data2,select=-genre)
data2=subset(data2,select=-sujet)
data2=subset(data2,select=-score)
data2=subset(data2,select=-inflx)
data2=scale(data2)
data2=as.data.frame(data2)
data2$genre=genre
data2$sujet=sujet
data2$score=score
data2$inflx=inflx
data<-read.csv('train_maladie.csv', header = T, sep = ",",dec=".")
moment_inflexion=numeric(42)
for (i in 1:42){
patient<-data %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
moment_inflexion[i]=patient$duree[indice_max_variation_patient]
}
data2<-data
data2 <- data2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[sujet]) %>%
ungroup()
data2$inflx=(data2$duree>data2$inflexion)
data2=subset(data2,select=-inflexion)
data2$inflx=as.numeric(data2$inflx)
set.seed(2023)
train=sample_frac(data2,0.8) #On tire au sort 80% de notre jeu de données qui va dans le train#
valid=anti_join(data2,train)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
data<-read.csv('train_maladie.csv', header = T, sep = ",",dec=".")
moment_inflexion=numeric(42)
for (i in 1:42){
patient<-data %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
moment_inflexion[i]=patient$duree[indice_max_variation_patient]
}
data2<-data
data2 <- data2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[sujet]) %>%
ungroup()
data2$inflx=(data2$duree>data2$inflexion)
data2=subset(data2,select=-inflexion)
data2$inflx=as.numeric(data2$inflx)
set.seed(2023)
mydata_split <- initial_split(data2, prop = .8)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
data<-read.csv('train_maladie.csv', header = T, sep = ",",dec=".")
moment_inflexion=numeric(42)
for (i in 1:42){
patient<-data %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
moment_inflexion[i]=patient$duree[indice_max_variation_patient]
}
data2<-data
data2 <- data2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[sujet]) %>%
ungroup()
data2$inflx=(data2$duree>data2$inflexion)
data2=subset(data2,select=-inflexion)
data2$inflx=as.numeric(data2$inflx)
set.seed(2023)
mydata_split <- initial_split(data2, prop = .82)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
data<-read.csv('train_maladie.csv', header = T, sep = ",",dec=".")
moment_inflexion=numeric(42)
for (i in 1:42){
patient<-data %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
moment_inflexion[i]=patient$duree[indice_max_variation_patient]
}
data2<-data
data2 <- data2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[sujet]) %>%
ungroup()
data2$inflx=(data2$duree>data2$inflexion)
data2=subset(data2,select=-inflexion)
data2$inflx=as.numeric(data2$inflx)
set.seed(2023)
mydata_split <- initial_split(data2, prop = .75)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree+FF.Abs+AV.dB|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
data<-read.csv('train_maladie.csv', header = T, sep = ",",dec=".")
moment_inflexion=numeric(42)
for (i in 1:42){
patient<-data %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
moment_inflexion[i]=patient$duree[indice_max_variation_patient]
}
data2<-data
data2 <- data2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[sujet]) %>%
ungroup()
data2$inflx=(data2$duree>data2$inflexion)
data2=subset(data2,select=-inflexion)
data2$inflx=as.numeric(data2$inflx)
set.seed(2023)
mydata_split <- initial_split(data2, prop = .78)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
set.seed(2023)
train=sample_frac(data2,0.7) #On tire au sort 80% de notre jeu de données qui va dans le train#
valid=anti_join(data2,train)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
set.seed(2023)
mydata_split <- initial_split(data2, prop = .78)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
set.seed(2023)
mydata_split <- initial_split(data2, prop = .7)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
set.seed(2023)
mydata_split <- initial_split(data2, prop = .8)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
set.seed(2023)
mydata_split <- initial_split(data2, prop = .78)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
set.seed(2023)
mydata_split <- initial_split(data2, prop = .75)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+(duree|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
mod_fin2=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin2= rmse(valid$score,predict(mod_fin, newdata = valid))
selected=c(1,7,11,17,21,31,32,41)
valid$pred_mod_m1 <- predict(mod_fin,newdata=valid)
valid %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
