sujet=train$sujet
score=train$score
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
genre=valid$genre
sujet=valid$sujet
score=valid$score
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
mod4=lmer(score ~ age +genre+duree+BTC1+BTC2+EFS+VFNL+AV.dB +(FF.Abs|  sujet), data = train, REML = FALSE)
RMSE4= rmse(valid$score,predict(mod4, newdata = valid))
mod5=lmer(score ~ age +genre+duree+BTC1+BTC2+EFS+VFNL + FF.Abs +(AV.dB|  sujet), data = train, REML = FALSE)
RMSE5= rmse(valid$score,predict(mod5, newdata = valid))
mod6=lmer(score ~ age +genre+duree+BTC1+BTC2+EFS+VFNL +(FF.Abs+AV.dB|  sujet), data = train, REML = FALSE)
RMSE6= rmse(valid$score,predict(mod6, newdata = valid))
#TROP GROS MODELE NE CONVERGE PAS
mod7=lmer(score ~ age +genre+duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet), data = train, REML = FALSE)
RMSE7= rmse(valid$score,predict(mod7, newdata = valid))
mod8=lmer(score ~ age +genre+duree+BTC1+BTC2+EFS+VFNL+CDNL +(FF.Abs+AV.dB|  sujet), data = train, REML = FALSE)
RMSE8= rmse(valid$score,predict(mod8, newdata = valid))
mod9=lmer(score ~ age +genre+duree+BTC1+BTC2+EFS+VFNL + FF.Abs +CDNL+(AV.dB|  sujet), data = train, REML = FALSE)
RMSE9= rmse(valid$score,predict(mod9, newdata = valid))
mod10=lmer(score ~ age +genre+duree+BTC1+BTC2+EFS+VFNL + FF.Abs +AV.dB +(1|  sujet), data = train)
RMSE10= rmse(valid$score,predict(mod10, newdata = valid))
m10update<-update(mod10, REML=FALSE)
RMSE10_UPDATE= rmse(valid$score,predict(m10update, newdata = valid))
valid$pred_mod_m1 <- predict(mod7,newdata=valid)
valid %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
train$pred_mod_m1 <- fitted(mod7)
train %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
Y_train=train$score
X_train=subset(train,select=-score)
Y_test=valid$score
X_test=subset(valid,select=-score)
xgb_trcontrol = trainControl(method = "cv", number = 5, allowParallel = TRUE,
verboseIter = FALSE, returnData = FALSE)
xgbGrid <- expand.grid(nrounds = c(100,200),
max_depth = c(3, 5, 10, 15, 20),
colsample_bytree = seq(0.5, 0.9, length.out = 5),
## valeurs par dÃ©faut :
eta = 0.1,
gamma=0,
min_child_weight = 1,
subsample=1
)
xgb_model = train(X_train, Y_train, trControl = xgb_trcontrol, tuneGrid = xgbGrid,
method = "xgbTree")
xgb_model$bestTune
predicted = predict(xgb_model, X_test)
residuals = Y_test - predicted
RMSE = sqrt(mean(residuals^2))
pred_mod_m1=predict(xgb_model,X_train)
train$pred_mod_m1=pred_mod_m1
train %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
valid$pred_mod_m1=predicted
valid %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
mod_fin=lmer(score ~ age +genre+duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet)+(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL| duree), data = train, REML = FALSE)
mod_fin=lmer(score ~ age +genre+duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL| duree + sujet), data = train, REML = FALSE)
mod_fin=lmer(score ~ age +genre+duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL| duree ,sujet), data = train, REML = FALSE)
mod_fin=lmer(score ~ age +genre+duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL| duree), data = train, REML = FALSE)
mod_fin=lmer(score ~ age +genre+duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL| duree), data = train, REML = FALSE)
train<-read.csv('train_maladie.csv', header = T, sep = ",",dec=".")
patient1<-train %>% filter(sujet %in% 1)
View(patient1)
patient17<-train %>% filter(sujet %in% 17)
View(patient17)
patient17<-patient17[order(patient17$duree)]
patient17<-patient17[order_by(patient17$duree)]
patient17<-patient17[order(patient17$duree),]
for (i in 1:102){
coeff_directeur.append((patient17$score[i+1]-patient17$score[i])/(duree[i+1]-duree[i])
}
for (i in 1:102){
coeff_directeur.append((patient17$score[i+1]-patient17$score[i])/(duree[i+1]-duree[i]))
}
for (i in 1:102){
append(coeff_directeur,(patient17$score[i+1]-patient17$score[i])/(duree[i+1]-duree[i]))
}
coeff_directeur=c()
for (i in 1:102){
append(coeff_directeur,(patient17$score[i+1]-patient17$score[i])/(duree[i+1]-duree[i]))
}
for (i in 1:102){
append(coeff_directeur,(patient17$score[i+1]-patient17$score[i])/(duree[i+1]-duree[i]))
}
for (i in 1:102){
append(coeff_directeur,(patient17$score[i+1]-patient17$score[i])/(patient17$duree[i+1]-patient17$duree[i]))
}
for (i in 1:102){
c(coeff_directeur,(patient17$score[i+1]-patient17$score[i])/(patient17$duree[i+1]-patient17$duree[i]))
}
coeff_directeur <- numeric(0)
for (i in 1:(length(patient17$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient17$score[i+1] - patient17$score[i]) / (patient17$duree[i+1] - patient17$duree[i]))
}
coeff_directeur
patient17$duree=round(patient1$duree)
patient17$duree=round(patient17$duree)
patient17 <- aggregate(patient17[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient1$duree), FUN = mean)
patient17 <- aggregate(patient17[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient17$duree), FUN = mean)
patient17 <- patient17 %>% rename(Group.1=duree)
names(patient17)[names(patient17) == "Group.1"] <- "duree"
for (i in 1:(length(patient17$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient17$score[i+1] - patient17$score[i]) / (patient17$duree[i+1] - patient17$duree[i]))
}
coeff_directeur <- numeric(0)
for (i in 1:(length(patient17$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient17$score[i+1] - patient17$score[i]) / (patient17$duree[i+1] - patient17$duree[i]))
}
coeff_directeur
selected=c(1,5,27,38,40,17)
train %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score)) + facet_wrap(~ sujet, ncol=2)
for (i in 1:42){
patient<-train %>% filter(sujet %in% i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (i in 1:(length(patient17$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient17$score[i+1] - patient17$score[i]) / (patient17$duree[i+1] - patient17$duree[i]))
}
liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
liste_coeff_directeur <- list()
for (i in 1:42){
patient<-train %>% filter(sujet %in% i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (i in 1:(length(patient17$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient17$score[i+1] - patient17$score[i]) / (patient17$duree[i+1] - patient17$duree[i]))
}
liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
liste_coeff_directeur
liste_coeff_directeur <- list()
for (i in 1:42){
patient<-train %>% filter(sujet %in% i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (i in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[i+1] - patient$score[i]) / (patient$duree[i+1] - patient$duree[i]))
}
liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
liste_coeff_directeur
df_coeff_directeur <- as.data.frame(liste_coeff_directeur)
liste_coeff_directeur$Patient_1
liste_coeff_directeur$bo
for (i in 1:42){
patient<-train %>% filter(sujet %in% i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (i in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[i+1] - patient$score[i]) / (patient$duree[i+1] - patient$duree[i]))
}
liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
liste_coeff_directeur <- list()
for (i in 1:42){
patient<-train %>% filter(sujet %in% i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (i in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[i+1] - patient$score[i]) / (patient$duree[i+1] - patient$duree[i]))
}
liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
liste_coeff_directeur
for (i in 1:42){
patient<-train %>% filter(sujet %in% i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
liste_coeff_directeur <- list()
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
print(coeff_directeur)
#liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
print("PATIENT",i)
print(coeff_directeur)
cat("\n")
#liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
print("<TU es",18)
print("le rÃ©sulytat est : " x)
print("le rÃ©sulytat est : " , troisieme_quartile)
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
print(paste("PATIENT",i))
print(coeff_directeur)
cat("\n")
#liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
liste_coeff_directeur <- list()
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=diff(coeff_directeur)
print(paste("PATIENT",i))
print(variations)
cat("\n")
#liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
print(paste("PATIENT",i))
print(variations)
cat("\n")
#liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
print(paste("PATIENT",i))
print(coeff_directeur)
cat("\n")
#liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
print(paste("PATIENT",i))
print(variations)
cat("\n")
#liste_coeff_directeur[[paste0("Patient_", i)]] <- coeff_directeur
}
indices_max_variation=c()
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(ecarts_successifs)
indices_max_variation=c(indices_max_variation,indice_max_variation_patient)
}
indices_max_variation=c()
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
indices_max_variation=c(indices_max_variation,indice_max_variation_patient)
}
indices_max_variation
moment inflexion=numeric(42)
moment_inflexion=numeric(42)
moment_inflexion=numeric(42)
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
moment_inflexion[i]=patient$duree[indice_max_variation_patient]
}
moment_inflexion
train2<-train
View(train2)
train2 <- train2 %>%
group_by(sujet) %>%
mutate(avant_inflexion = ifelse(duree <= train$duration[paste0("Patient_", sujet)][indices_max_variation[paste0("Patient_", sujet)]], 0, 1)) %>%
ungroup()
View(train2)
train2 <- train2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[paste0("Patient_", sujet)]) %>%
ungroup()
View(train2)
train2<-train
train2 <- train2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[sujet]) %>%
ungroup()
View(train2)
train2$inflx=(train2$duree>train2$inflexion)
View(train2)
train2=subset(train2,select=-inflexion)
train2$inflx=as.numeric(train2$inflx)
mydata_split <- initial_split(train2, prop = .7)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
genre=valid$genre
sujet=valid$sujet
score=valid$score
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
mod_fin=lmer(score ~ age +genre+duree+(1+duree| sujet)+(1+duree | inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
train<-read.csv('train_maladie.csv', header = T, sep = ",",dec=".")
for (i in 1:42){
patient<-train %>% filter(sujet ==i)
patient$duree=round(patient$duree)
patient <- aggregate(patient[c("age","genre","score","FF","FF.Abs","FF.RAP","FF.PPQ5","FF.DDP","AV","AV.dB","AV.APQ3","AV.APQ5","AV.APQ11","AV.DDA","BTC1","BTC2","CDNL","EFS","VFNL")], by = list(patient$duree), FUN = mean)
names(patient)[names(patient) == "Group.1"] <- "duree"
coeff_directeur <- numeric(0)
for (j in 1:(length(patient$duree)-1)) {
coeff_directeur <- c(coeff_directeur, (patient$score[j+1] - patient$score[j]) / (patient$duree[j+1] - patient$duree[j]))
}
variations=abs(diff(coeff_directeur))
indice_max_variation_patient <- which.max(variations)
moment_inflexion[i]=patient$duree[indice_max_variation_patient]
}
train2<-train
train2 <- train2 %>%
group_by(sujet) %>%
mutate(inflexion = moment_inflexion[sujet]) %>%
ungroup()
train2$inflx=(train2$duree>train2$inflexion)
train2=subset(train2,select=-inflexion)
train2$inflx=as.numeric(train2$inflx)
mydata_split <- initial_split(train2, prop = .7)
train <- training(mydata_split)
valid  <- testing(mydata_split)
genre=train$genre
sujet=train$sujet
score=train$score
inflx=train$inflx
train=subset(train,select=-genre)
train=subset(train,select=-sujet)
train=subset(train,select=-score)
train=subset(train,select=-inflx)
train=scale(train)
train=as.data.frame(train)
train$genre=genre
train$sujet=sujet
train$score=score
train$inflx=inflx
genre=valid$genre
sujet=valid$sujet
score=valid$score
inflx=valid$inflx
valid=subset(valid,select=-genre)
valid=subset(valid,select=-sujet)
valid=subset(valid,select=-score)
valid=subset(valid,select=-inflx)
valid=scale(valid)
valid=as.data.frame(valid)
valid$genre=genre
valid$sujet=sujet
valid$score=score
valid$inflx=inflx
View(valid)
mod_fin=lmer(score ~ age +genre+duree+(1+duree| sujet)+(1+duree | inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
selected
selected=c(3,7,11,17,21,31,32,41)
valid$pred_mod_m1 <- predict(mod_fin,newdata=valid)
valid %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
train$pred_mod_m1 <- fitted(mod_fin)
train %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
mod_fin=lmer(score ~ age +genre+duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet)+(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod7, newdata = valid))
valid$pred_mod_m1 <- predict(mod_fin,newdata=valid)
valid %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
train$pred_mod_m1 <- fitted(mod_fin)
train %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet)+(duree|  inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod7, newdata = valid))
RMSE_fin= rmse(valid$score,predict(mod7, newdata = valid))
mod_fin=lmer(score ~ age +genre +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet)+(duree|  inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod7, newdata = valid))
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet)+(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
mod_fin=lmer(score ~ age +genre+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL +(duree+FF.Abs+AV.dB+BTC1+BTC2+EFS+VFNL+CDNL|  sujet:inflx), data = train, REML = FALSE)
RMSE_fin= rmse(valid$score,predict(mod_fin, newdata = valid))
valid$pred_mod_m1 <- predict(mod_fin,newdata=valid)
valid %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
train$pred_mod_m1 <- fitted(mod_fin)
train %>% filter(sujet %in% selected) %>%
ggplot() + geom_point(aes(x = duree, y = score), color="red", size=3) +
geom_line(aes(x = duree, y = pred_mod_m1)) + facet_wrap(~ sujet, ncol=4)
